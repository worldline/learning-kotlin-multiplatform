<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Local  Database","image":[""],"dateModified":"2025-09-03T13:19:16.000Z","author":[]}</script><meta property="og:url" content="https://worldline.github.io/learning-kotlin-multiplatform/learning-kotlin-multiplatform/9.database/"><meta property="og:title" content="Local  Database"><meta property="og:description" content="Local Database Deprecated section SQL delight is for now no more compatible with the new default WASM template for WebApp application. If you still want to use it you can revert..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2025-09-03T13:19:16.000Z"><meta property="article:modified_time" content="2025-09-03T13:19:16.000Z"><link rel="icon" href="/learning-kotlin-multiplatform/favicon.ico"><link rel="manifest" href="/learning-kotlin-multiplatform/manifest.webmanifest"><meta name="theme-color" content="#bf4092"><meta name="mobile-web-app-capable" content="yes"><link rel="apple-touch-icon" href="/learning-kotlin-multiplatform/logo.png"><title>Local  Database</title><meta name="description" content="Local Database Deprecated section SQL delight is for now no more compatible with the new default WASM template for WebApp application. If you still want to use it you can revert...">
    <link rel="preload" href="/learning-kotlin-multiplatform/assets/style-D_ZGXx4T.css" as="style"><link rel="stylesheet" href="/learning-kotlin-multiplatform/assets/style-D_ZGXx4T.css">
    <link rel="modulepreload" href="/learning-kotlin-multiplatform/assets/app-CarcV5a4.js"><link rel="modulepreload" href="/learning-kotlin-multiplatform/assets/index.html-Dd41ybDI.js">
    
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/learning-kotlin-multiplatform/"><img class="vp-site-logo" src="/learning-kotlin-multiplatform/logo_worldline.png" alt><!----></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/worldline/learning-kotlin-multiplatform" aria-label="‚≠ê¬†Contribute!" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->‚≠ê¬†Contribute!<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search..." autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/worldline/learning-kotlin-multiplatform" aria-label="‚≠ê¬†Contribute!" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->‚≠ê¬†Contribute!<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/learning-kotlin-multiplatform/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/learning-kotlin-multiplatform/1.overview/" aria-label="üöÄ Let&#39;s start"><!--[--><!--[--><!--]--><!--]-->üöÄ Let&#39;s start<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/learning-kotlin-multiplatform/0.language/" aria-label="About Kotlin"><!--[--><!--[--><!--]--><!--]-->About Kotlin<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/learning-kotlin-multiplatform/2.configure/" aria-label="Configure KMP"><!--[--><!--[--><!--]--><!--]-->Configure KMP<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/learning-kotlin-multiplatform/3.ui/" aria-label="User interface"><!--[--><!--[--><!--]--><!--]-->User interface<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/learning-kotlin-multiplatform/4.nav/" aria-label="Navigation"><!--[--><!--[--><!--]--><!--]-->Navigation<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/learning-kotlin-multiplatform/5.res/" aria-label="Ressources"><!--[--><!--[--><!--]--><!--]-->Ressources<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/learning-kotlin-multiplatform/6.arch/" aria-label="Architecture"><!--[--><!--[--><!--]--><!--]-->Architecture<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/learning-kotlin-multiplatform/7.connect/" aria-label="Connectivity"><!--[--><!--[--><!--]--><!--]-->Connectivity<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/learning-kotlin-multiplatform/8.preferences/" aria-label="Preferences"><!--[--><!--[--><!--]--><!--]-->Preferences<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/learning-kotlin-multiplatform/9.database/" aria-label="Local  Database"><!--[--><!--[--><!--]--><!--]-->Local  Database<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="local-database" tabindex="-1"><a class="header-anchor" href="#local-database"><span>Local Database</span></a></h1><div class="hint-container warning"><p class="hint-container-title">Deprecated section</p><p><code>SQL delight</code> is for now no more compatible with the new default <strong>WASM</strong> template for WebApp application.</p><p>If you still want to use it you can revert to the old <strong>Js(IR)</strong> template.</p><p>Notice that for now this is the <strong>only</strong> Web target compatible database library for KMP</p></div><p>SQLDelight generates typesafe Kotlin APIs from your SQL statements. It verifies your schema, statements, and migrations at compile-time and provides IDE features like autocomplete and refactoring which make writing and maintaining SQL simple.</p><p>SQLDelight understands your existing SQL schema.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> hockey_player <span class="token punctuation">(</span></span>
<span class="line">  id <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> AUTOINCREMENT<span class="token punctuation">,</span></span>
<span class="line">  name <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  number <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>It generates typesafe code for any labeled SQL statements.</p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Be carefull with SQL Delight , the project and his dependancies just move from <code>com.squareup.sqldelight.*</code> to <code>app.cash.sqldelight.*</code></p><p>Pay attention also with beta, alpha version of Android studio that could produce bugs on gradle task management for code generation of SQL Delight databases.</p></div><h2 id="üß™-add-sqldelight-db-to-your-quizz" tabindex="-1"><a class="header-anchor" href="#üß™-add-sqldelight-db-to-your-quizz"><span>üß™ Add sqldelight db to your quizz</span></a></h2><blockquote><p>Refer to the multiplatform implementation of SQLDelight in official Github pages üëâ <a href="https://cashapp.github.io/sqldelight/2.0.0/multiplatform_sqlite/" target="_blank" rel="noopener noreferrer">https://cashapp.github.io/sqldelight/2.0.0/multiplatform_sqlite/</a></p></blockquote><h4 id="add-the-correct-dependancies-to-the-project" tabindex="-1"><a class="header-anchor" href="#add-the-correct-dependancies-to-the-project"><span>Add the correct dependancies to the project</span></a></h4><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line">plugins <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">..</span><span class="token punctuation">.</span></span>
<span class="line">    <span class="token function">alias</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>sqldelight<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">..</span><span class="token punctuation">.</span></span>
<span class="line"> sourceSets <span class="token punctuation">{</span></span>
<span class="line">         commonMain<span class="token punctuation">.</span><span class="token function">dependencies</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token operator">..</span><span class="token punctuation">.</span></span>
<span class="line">            <span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>sqldelight<span class="token punctuation">.</span>runtime<span class="token punctuation">)</span></span>
<span class="line">            <span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>sqldelight<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>extensions<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">         androidMain<span class="token punctuation">.</span><span class="token function">dependencies</span> <span class="token punctuation">{</span></span>
<span class="line">               <span class="token operator">..</span><span class="token punctuation">.</span></span>
<span class="line">                 <span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>sqldelight<span class="token punctuation">.</span>android<span class="token punctuation">.</span>driver<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">..</span><span class="token punctuation">.</span></span>
<span class="line">        iosMain<span class="token punctuation">.</span><span class="token function">dependencies</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token operator">..</span><span class="token punctuation">.</span></span>
<span class="line">                 <span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>sqldelight<span class="token punctuation">.</span>ios<span class="token punctuation">.</span>driver<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">         desktopMain<span class="token punctuation">.</span><span class="token function">dependencies</span> <span class="token punctuation">{</span></span>
<span class="line">               <span class="token operator">..</span><span class="token punctuation">.</span></span>
<span class="line">                 <span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>sqldelight<span class="token punctuation">.</span>jvm<span class="token punctuation">.</span>driver<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        wasmJsMain<span class="token punctuation">.</span><span class="token function">dependencies</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token operator">..</span><span class="token punctuation">.</span></span>
<span class="line">            <span class="token function">implementation</span><span class="token punctuation">(</span>libs<span class="token punctuation">.</span>sqldelight<span class="token punctuation">.</span>webworker<span class="token punctuation">.</span>driver<span class="token punctuation">)</span></span>
<span class="line">            <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token function">npm</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;sql.js&quot;</span></span><span class="token punctuation">,</span> libs<span class="token punctuation">.</span>versions<span class="token punctuation">.</span>sqlJs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token function">devNpm</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;copy-webpack-plugin&quot;</span></span><span class="token punctuation">,</span> libs<span class="token punctuation">.</span>versions<span class="token punctuation">.</span>webPackPlugin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">..</span><span class="token punctuation">.</span></span>
<span class="line"></span>
<span class="line">        sqldelight <span class="token punctuation">{</span></span>
<span class="line">            databases <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">create</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Database&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    packageName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;com.myapplication.common.cache&quot;</span></span></span>
<span class="line">                    generateAsync <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">                    verifyMigrations <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            linkSqlite <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="create-the-native-sql-driver-factory-and-use-it-for-creating-the-db-with-actual-expect-kotlin-keywords" tabindex="-1"><a class="header-anchor" href="#create-the-native-sql-driver-factory-and-use-it-for-creating-the-db-with-actual-expect-kotlin-keywords"><span>Create the native SQL driver factory and use it for creating the DB with <code>actual</code>/<code>expect</code> kotlin keywords</span></a></h4><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">actual</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">provideDbDriver</span><span class="token punctuation">(</span></span>
<span class="line">    schema<span class="token operator">:</span> SqlSchema<span class="token operator">&lt;</span>QueryResult<span class="token punctuation">.</span>AsyncValue<span class="token operator">&lt;</span>Unit<span class="token operator">&gt;</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> SqlDriver <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">JdbcSqliteDriver</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;jdbc:sqlite:quiz.db&quot;</span></span><span class="token punctuation">,</span> <span class="token function">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span> schema<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">actual</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">provideDbDriver</span><span class="token punctuation">(</span></span>
<span class="line">    schema<span class="token operator">:</span> SqlSchema<span class="token operator">&lt;</span>QueryResult<span class="token punctuation">.</span>AsyncValue<span class="token operator">&lt;</span>Unit<span class="token operator">&gt;</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> SqlDriver <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">NativeSqliteDriver</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span><span class="token function">synchronous</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;quiz.db&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">actual</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">provideDbDriver</span><span class="token punctuation">(</span></span>
<span class="line">    schema<span class="token operator">:</span> SqlSchema<span class="token operator">&lt;</span>QueryResult<span class="token punctuation">.</span>AsyncValue<span class="token operator">&lt;</span>Unit<span class="token operator">&gt;</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> SqlDriver <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">AndroidSqliteDriver</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span><span class="token function">synchronous</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> QuizApp<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;quiz.db&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">actual</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">provideDbDriver</span><span class="token punctuation">(</span>schema<span class="token operator">:</span> SqlSchema<span class="token operator">&lt;</span>QueryResult<span class="token punctuation">.</span>AsyncValue<span class="token operator">&lt;</span>Unit<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> SqlDriver <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">WebWorkerDriver</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token function">jsWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">fun</span> <span class="token function">jsWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Worker <span class="token operator">=</span></span>
<span class="line">    <span class="token function">js</span><span class="token punctuation">(</span><span class="token string-literal multiline"><span class="token string">&quot;&quot;&quot;new Worker(new URL(&quot;./sqljs.worker.js&quot;, import.meta.url))&quot;&quot;&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>for the WebWorker you need to create a webpack.config.d/config.js file in the root of your project and a webpack.config.d/sqljs-config.js for the web worker to be able to use the sql wasm library.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;terser-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">config<span class="token punctuation">.</span>optimization <span class="token operator">=</span> config<span class="token punctuation">.</span>optimization <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">config<span class="token punctuation">.</span>optimization<span class="token punctuation">.</span>minimize <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">config<span class="token punctuation">.</span>optimization<span class="token punctuation">.</span>minimizer <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">terserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">mangle</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token comment">// Note: By default, mangle is set to true.</span></span>
<span class="line">            <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// Disable the transformations that reduce the code size.</span></span>
<span class="line">            <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">beautify</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// {project}/webpack.config.d/sqljs.js</span></span>
<span class="line">config<span class="token punctuation">.</span>resolve <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">fs</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">crypto</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> CopyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;copy-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">patterns</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">&#39;../../node_modules/sql.js/dist/sql-wasm.wasm&#39;</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="read-carefully-the-modelisation-uml-below" tabindex="-1"><a class="header-anchor" href="#read-carefully-the-modelisation-uml-below"><span>Read carefully the modelisation UML below</span></a></h4><p><img src="/learning-kotlin-multiplatform/assets/diagramme_sql-CFrbOXnm.png" alt="diagram SQL "></p><h4 id="create-you-sqldelight-model-quizdatabase-sq" tabindex="-1"><a class="header-anchor" href="#create-you-sqldelight-model-quizdatabase-sq"><span>Create you SQLDelight model &#39;QuizDatabase.sq&#39;</span></a></h4><h4 id="create-your-database-datasource-by-generating-insert-and-update-suspending-functions" tabindex="-1"><a class="header-anchor" href="#create-your-database-datasource-by-generating-insert-and-update-suspending-functions"><span>Create your Database datasource by generating insert and update suspending functions</span></a></h4><h4 id="update-your-repository-by-instanciating-your-database" tabindex="-1"><a class="header-anchor" href="#update-your-repository-by-instanciating-your-database"><span>Update your repository by instanciating your database</span></a></h4><p>Your repository handle the following cases :</p><ul><li>If there is no network and it&#39;s the first time launch of the app : handle and error</li><li>if there is no network and you have db datas : return on the flow the db data</li><li>if there is network and db data are younger than 5 min : return on the flow the db data</li><li>if there is network and db data are older than 5 min : retourn on the flow the network data and reset db data</li></ul><h2 id="üéØ-solutions" tabindex="-1"><a class="header-anchor" href="#üéØ-solutions"><span>üéØ Solutions</span></a></h2><details class="hint-container details"><summary>QuizDatabase.sq (ressources of commonMain)*</summary><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> update_time <span class="token punctuation">(</span></span>
<span class="line">     timestamprequest <span class="token keyword">INTEGER</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> update_time<span class="token punctuation">(</span>timestamprequest<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> questions <span class="token punctuation">(</span></span>
<span class="line">    id <span class="token keyword">INTEGER</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></span>
<span class="line">    label <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    correctAnswerId <span class="token keyword">INTEGER</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span></span>
<span class="line"> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> answers <span class="token punctuation">(</span></span>
<span class="line">    id <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    label <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    question_id <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> question_id<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>question_id<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">REFERENCES</span> questions <span class="token punctuation">(</span>id<span class="token punctuation">)</span></span>
<span class="line">          <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span></span>
<span class="line">          <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span></span>
<span class="line"> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> selectUpdateTimestamp:</span>
<span class="line"> <span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line"> <span class="token keyword">FROM</span> update_time<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> insertTimeStamp:</span>
<span class="line"> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> update_time<span class="token punctuation">(</span>timestamprequest<span class="token punctuation">)</span></span>
<span class="line"> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>:<span class="token keyword">timestamp</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> deleteTimeStamp:</span>
<span class="line"> <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> update_time<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> deleteQuestions:</span>
<span class="line"> <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> questions<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> deleteAnswers:</span>
<span class="line"> <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> answers<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"> selectAllQuestionsWithAnswers:</span>
<span class="line"> <span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line"> <span class="token keyword">FROM</span> questions</span>
<span class="line"> <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> answers <span class="token keyword">ON</span> questions<span class="token punctuation">.</span>id <span class="token operator">=</span> answers<span class="token punctuation">.</span>question_id<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> insertQuestion:</span>
<span class="line"> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> questions<span class="token punctuation">(</span>id<span class="token punctuation">,</span> label<span class="token punctuation">,</span>correctAnswerId<span class="token punctuation">)</span></span>
<span class="line"> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> insertAnswer:</span>
<span class="line"> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> answers<span class="token punctuation">(</span>id<span class="token punctuation">,</span> label<span class="token punctuation">,</span>question_id<span class="token punctuation">)</span></span>
<span class="line"> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><details class="hint-container details"><summary>data/datasources (commonMain)</summary><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">class</span> <span class="token function">SqlDelightDataSource</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> database<span class="token operator">:</span> Database<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">var</span> quizQueries <span class="token operator">=</span> database<span class="token punctuation">.</span>quizQuestionQueries</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">getAllQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Question<span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> quizQueries<span class="token punctuation">.</span><span class="token function">selectAllQuestionsWithAnswers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">awaitAsList</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">groupBy</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>question_id <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>questionId<span class="token punctuation">,</span> rowList<span class="token punctuation">)</span> <span class="token operator">-&gt;</span></span>
<span class="line"></span>
<span class="line">                <span class="token function">Question</span><span class="token punctuation">(</span></span>
<span class="line">                    id <span class="token operator">=</span> questionId<span class="token punctuation">,</span></span>
<span class="line">                    label <span class="token operator">=</span> rowList<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>label<span class="token punctuation">,</span></span>
<span class="line">                    correctAnswerId <span class="token operator">=</span> rowList<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>correctAnswerId<span class="token punctuation">,</span></span>
<span class="line">                    answers <span class="token operator">=</span> rowList<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> answer <span class="token operator">-&gt;</span></span>
<span class="line">                        <span class="token function">Answer</span><span class="token punctuation">(</span></span>
<span class="line">                            id <span class="token operator">=</span> answer<span class="token punctuation">.</span>id_<span class="token punctuation">,</span></span>
<span class="line">                            label <span class="token operator">=</span> answer<span class="token punctuation">.</span>label_</span>
<span class="line">                        <span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">insertQuestions</span><span class="token punctuation">(</span>questions<span class="token operator">:</span> List<span class="token operator">&lt;</span>Question<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        quizQueries<span class="token punctuation">.</span><span class="token function">deleteQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        quizQueries<span class="token punctuation">.</span><span class="token function">deleteAnswers</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        questions<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span> question <span class="token operator">-&gt;</span></span>
<span class="line">            quizQueries<span class="token punctuation">.</span><span class="token function">insertQuestion</span><span class="token punctuation">(</span>question<span class="token punctuation">.</span>id<span class="token punctuation">,</span> question<span class="token punctuation">.</span>label<span class="token punctuation">,</span> question<span class="token punctuation">.</span>correctAnswerId<span class="token punctuation">)</span></span>
<span class="line">            question<span class="token punctuation">.</span>answers<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span> answer <span class="token operator">-&gt;</span></span>
<span class="line">                quizQueries<span class="token punctuation">.</span><span class="token function">insertAnswer</span><span class="token punctuation">(</span>answer<span class="token punctuation">.</span>id<span class="token punctuation">,</span> answer<span class="token punctuation">.</span>label<span class="token punctuation">,</span> question<span class="token punctuation">.</span>id<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">resetQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        quizQueries<span class="token punctuation">.</span><span class="token function">deleteQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        quizQueries<span class="token punctuation">.</span><span class="token function">deleteAnswers</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><details class="hint-container details"><summary>QuizRepository.kt</summary><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt"><pre><code class="language-kotlin"><span class="line"><span class="token keyword">class</span> QuizRepository <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">val</span> mockDataSource <span class="token operator">=</span> <span class="token function">MockDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">val</span> quizApiDatasource <span class="token operator">=</span> <span class="token function">QuizApiDatasource</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">var</span> quizKStoreDataSource <span class="token operator">=</span> <span class="token function">KStoreDataSource</span><span class="token punctuation">(</span>AppInitializer<span class="token punctuation">.</span><span class="token function">getKStoreInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">var</span> sqlDelightDataSource <span class="token operator">=</span> <span class="token function">SqlDelightDataSource</span><span class="token punctuation">(</span>AppInitializer<span class="token punctuation">.</span><span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!!</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">fetchQuiz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Question<span class="token operator">&gt;</span> <span class="token operator">=</span> quizApiDatasource<span class="token punctuation">.</span><span class="token function">getAllQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>questions</span>
<span class="line"></span>
<span class="line">    <span class="token annotation builtin">@OptIn</span><span class="token punctuation">(</span>ExperimentalTime<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">fetchAndStoreQuiz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Question<span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        sqlDelightDataSource<span class="token punctuation">.</span><span class="token function">resetQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">val</span> questions <span class="token operator">=</span> <span class="token function">fetchQuiz</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        sqlDelightDataSource<span class="token punctuation">.</span><span class="token function">insertQuestions</span><span class="token punctuation">(</span>questions<span class="token punctuation">)</span></span>
<span class="line">        quizKStoreDataSource<span class="token punctuation">.</span><span class="token function">setUpdateTimeStamp</span><span class="token punctuation">(</span>Clock<span class="token punctuation">.</span>System<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>epochSeconds<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> questions</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation builtin">@OptIn</span><span class="token punctuation">(</span>ExperimentalTime<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">updateQuiz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Question<span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">val</span> lastRequest <span class="token operator">=</span> quizKStoreDataSource<span class="token punctuation">.</span><span class="token function">getUpdateTimeStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>lastRequest <span class="token operator">==</span> <span class="token number">0L</span> <span class="token operator">||</span> lastRequest <span class="token operator">-</span> Clock<span class="token punctuation">.</span>System<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>epochSeconds <span class="token operator">&gt;</span> <span class="token number">300000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">fetchAndStoreQuiz</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//quizKStoreDataSource.getAllQuestions()</span></span>
<span class="line">                sqlDelightDataSource<span class="token punctuation">.</span><span class="token function">getAllQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> NullPointerException<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token function">fetchAndStoreQuiz</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> mockDataSource<span class="token punctuation">.</span><span class="token function">generateDummyQuestionsList</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><div class="hint-container tip"><p class="hint-container-title">More databases options</p><p>For not using SQLight ORM, you can use <a href="https://github.com/realm/realm-kotlin" target="_blank" rel="noopener noreferrer"><code>Realm kotlin</code></a> or <a href="https://github.com/xxfast/KStore" target="_blank" rel="noopener noreferrer">KStore</a></p></div><p><strong>‚úÖ If everything is fine, go to the next chapter ‚Üí</strong></p><h2 id="üìñ-further-reading" tabindex="-1"><a class="header-anchor" href="#üìñ-further-reading"><span>üìñ Further reading</span></a></h2><ul><li><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-ktor-sqldelight.html" target="_blank" rel="noopener noreferrer">SQL Delight tutorial (obsolete)</a></li><li><a href="https://github.com/cashapp/sqldelight" target="_blank" rel="noopener noreferrer">SQL Delight lib </a></li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/worldline/learning-kotlin-multiplatform/edit/main/9.database/README.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]--><!--]-->Edit this page<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><time class="meta-item-info" datetime="2025-09-03T13:19:16.000Z" data-allow-mismatch>9/3/25, 1:19 PM</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: ibrahim.gharbi@worldline.com">A187839</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: brah.gharbi@gmail.com">Ibrahim Gharbi</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: brah.gharbi@gmail.com">Brah</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/learning-kotlin-multiplatform/8.preferences/" aria-label="Preferences"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">Preferences</span></div><!--]--></a><!----></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/learning-kotlin-multiplatform/assets/app-CarcV5a4.js" defer></script>
  </body>
</html>
